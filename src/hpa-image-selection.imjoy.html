<docs lang="markdown">
    [TODO: write documentation for this plugin.]
    </docs>
    
    <config lang="json">
    {
      "name": "HPA-Image-Selection",
      "type": "window",
      "tags": [],
      "ui": "",
      "version": "0.1.4",
      "api_version": "0.1.2",
      "description": "This is a backbone plugin for using Vue.js in ImJoy",
      "icon": "extension",
      "inputs": null,
      "outputs": null,
      "env": "",
      "requirements": [
            "https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.22/vue.min.js"
      ],
      "dependencies": [],
      "defaults": {"w": 50, "h": 30},
      "runnable": true
    }
    </config>
    
    <script lang="javascript">
    const default_image_ids = [
    "115_672_E2_1",
    "55353_957_C5_5",
    "49106_750_F9_2",
    "8743_111_G6_1",
    "36431_412_H6_2",
    "61073_1159_E12_1",
    "16312_947_H11_1",
    "55418_1027_A3_6",
    "16312_947_H11_2",
    "16845_138_E4_1",
    "10036_970_G1_4",
    "30174_277_B9_1",
    "45736_1695_A4_18",
    "29529_273_A7_2",
    "36645_404_A7_1",
    "28429_255_C6_2",
    "53304_1938_B1_21",
    "60349_1877_E4_31",
    "27501_232_B12_2",
    "2064_1222_F6_5",
    "4285_659_F2_3",
    "41707_1734_E9_1",
    "29308_321_A12_3",
    "634_23_E4_2",
    "43921_737_A8_2",
    "8751_101_E4_1",
    "61967_1116_E11_2",
    "43255_571_C12_1",
    "19404_611_H6_2",
    "17322_1386_G4_2",
    "47707_791_F9_1",
    "31093_1035_C12_8",
    "30351_297_G10_1",
    "17613_1399_G9_2",
    "40099_758_B6_1",
    "69323_1527_A7_6",
    "18334_144_D11_1",
    "23880_1525_D1_2",
    "14002_105_A7_1",
    "3054_159_C1_1",
    "3230_2_F4_2",
    "6028_33_C7_1",
    "28700_264_C10_2",
    "42596_481_C2_1",
    "37740_431_E3_1",
    "57975_1676_D10_1",
    "5758_973_F1_1",
    "67117_1283_D10_3",
    "4807_91_G2_1",
    "14861_121_G5_1",
    "58763_1009_D9_1",
    "27424_583_E9_1",
    "7875_38_D12_1",
    "39378_1042_E10_2",
    "50311_1040_D9_2",
    "19805_247_D7_1",
    "52062_1509_B11_1",
    "23286_236_A7_1",
    "29167_322_B12_1",
    "56977_968_D3_2",
    "28136_255_A8_1",
    "29164_1526_E8_2",
    "31166_329_D6_2",
    "41068_552_D10_1",
    "12604_136_D8_2",
    "36526_404_H6_1",
    "17114_614_B1_3",
    "27231_1161_C8_1",
    "1514_652_H1_1",
    "19829_247_F5_2",
    "52348_832_G8_2",
    "54461_1309_F1_2",
    "3218_1383_E6_2",
    "54474_867_H7_2",
    "48182_1482_D5_2",
    "43191_1495_B5_4",
    "21465_147_B9_1",
    "40976_1137_F12_3",
    "42165_467_D3_3",
    "53568_867_C4_2",
    "36152_593_G8_1",
    "51697_769_D6_2",
    "19849_263_B2_1",
    "43572_813_E7_1",
    "15127_126_E3_2",
    "60022_1226_D2_2",
    "75905_1639_G3_2",
    "64990_1282_F10_3",
    "55864_1050_A9_2",
    "9695_1446_C4_1",
    "36347_1526_B2_2",
    "56142_976_E6_1",
    "3233_57_H5_1",
    "7009_1843_F1_28",
    "29673_572_G1_1",
    "31216_319_G9_1",
    "73545_1348_B1_3",
    "27328_958_E12_2",
    "58631_995_F4_2",
    "37391_517_F3_1",
    "50100_1326_G4_2",
    "42317_754_B1_2",
    "36160_381_E10_2",
    "70567_1845_B4_61",
    "43932_789_D6_2",
    "47869_824_C6_2",
    "38883_448_A1_1",
    "650_1612_H3_8",
    "57574_997_B9_3",
    "46522_1591_A3_1",
    "56792_913_D9_4",
    "21282_146_B3_2",
    "49280_1568_A1_5",
    "28626_546_C8_6",
    "55997_879_H9_2",
    "9952_931_A9_4",
    "39325_1587_C4_2",
    "43718_487_F5_2",
    "77073_1920_E7_10",
    "62422_1148_D10_2",
    "10225_931_C10_4",
    "24000_195_G5_2",
    "43911_498_H2_2",
    "70240_1751_E5_3",
    "34734_580_B11_2",
    "37404_846_F9_6",
    "50450_977_A4_5",
    "58438_1037_B5_2",
    "4734_113_A1_1",
    "54128_869_E8_2",
    "43858_780_E8_2",
    "30843_1721_H4_8",
    "49235_764_E10_1",
    "35207_370_E9_2",
    "27824_231_D10_2",
    "54474_834_H8_3",
    "24026_241_G3_2",
    "45582_633_A9_2",
    "29515_405_F5_1",
    "45929_1823_G3_36",
    "5455_4_E12_1",
    "42411_476_G8_2",
    "42050_567_H11_1",
    "4028_628_B8_1",
    "35140_383_F9_1",
    "17562_1035_C8_1",
    "29143_365_E2_1",
    "76992_1707_D3_17",
    "39374_520_H8_2",
    "53524_835_A7_1",
    "63607_1271_E3_2",
    "56288_1335_A1_9",
    "63527_1170_D11_2",
    "28885_587_H9_3",
    "64814_1215_A4_2",
    "65409_1254_E7_2",
    "75513_2007_A9_1",
    "43513_752_G3_1",
    "61538_1828_C12_2",
    "11055_87_A10_2",
    "65118_1883_A10_31",
    "38076_440_G7_1",
    "23548_217_G12_1",
    "7247_161_H2_1",
    "4213_653_A5_1",
    "77264_1709_G3_12",
    "35795_380_E1_2",
    "50062_864_B1_3",
    "58921_1100_E7_3",
    "20636_183_B12_1",
    "13505_629_E4_1",
    "8726_41_F10_2",
    "5434_1752_F10_8",
    "44487_896_H2_2",
    "12058_95_H3_1",
    "40979_510_F2_2",
    "57224_975_B6_2",
    "43135_490_G3_1",
    "36233_712_C2_3",
    "41600_554_D7_1",
    "54926_1752_C9_23",
    "53529_1472_A6_2",
    "12568_201_E4_1",
    "864_39_D3_2",
    "43507_1047_A5_1",
    "71224_1339_E6_3",
    "26522_1660_F5_3",
    "43695_498_B11_1",
    "75831_1835_G3_7",
    "69356_1520_B4_3",
    "27883_322_G4_1",
    "29756_1610_H9_3",
    "56391_1213_C1_5",
    "16758_279_A4_2",
    "37577_523_F4_1",
    "40981_393_B3_2",
    "17886_150_B6_1",
    "56391_1213_C1_2",
    "19678_235_G1_1",
    "7390_1868_C2_35",
    "36800_442_C4_2",
    "74325_1437_D3_1",
    "29198_1866_A1_37",
    "20844_614_E10_1",
    "37574_425_D2_2",
    "66194_1296_C10_3",
    "64795_1164_D5_1",
    "67823_1422_D3_1",
    "28510_272_A2_2",
    "64839_1346_C2_1",
    "19369_152_A11_1",
    "38742_471_D3_2",
    "16700_131_E12_1",
    "78220_1715_H8_8",
    "71228_1510_B9_2",
    "46063_1016_E3_2",
    "44470_526_B12_1",
    "47818_784_G12_2",
    "27429_231_F6_2",
    "41229_480_H7_7",
    "50899_712_H9_1",
    "17998_145_D7_1",
    "30447_1207_H2_2",
    "55839_1050_C9_1",
    "55459_878_F5_2",
    "49854_823_F1_3",
    "37756_1377_A3_1",
    "72004_1989_F9_3",
    "15725_112_C8_1",
    "65404_1213_A5_1",
    "11101_52_B4_1",
    "66538_1247_G10_7",
    "4747_10_A3_1",
    "22896_237_B2_2",
    "58_952_H5_3",
    "78664_1763_F6_3",
    "15313_125_C6_2",
    "39982_1848_A8_31",
    "34745_397_G8_2",
    "1170_967_G9_3",
    "79912_1987_E10_1",
    "29391_291_C11_1",
    "43507_1048_A5_2",
    "53408_806_F7_2",
    "62253_1338_B6_2",
    "45128_562_F7_2",
    "40748_480_A1_4",
    "29039_340_H8_2",
    "16603_1601_D12_2",
    "54108_1309_A1_2",
    "55435_1370_G1_3",
    "296_1877_C2_19",
    "41559_557_B4_2",
    "7208_74_F5_2",
    "20863_187_B1_2",
    "64443_1318_D4_1",
    "2809_58_B2_2",
    "62711_1269_F6_3",
    "12678_95_E11_1",
    "26322_607_F6_2",
    "47132_622_H10_6",
    "44371_1669_A5_2",
    "29747_297_H2_2",
    "32131_396_B11_2",
    "47243_1040_G10_1",
    "1356_27_C7_2",
    "36458_750_B3_2",
    "28185_257_G6_2",
    "8926_43_F11_1",
    "17126_611_E1_1",
    "18957_620_B12_2",
    "48267_740_B11_3",
    "12814_99_E6_1",
    "40542_385_E1_2",
    "19543_198_A12_2",
    "52824_831_B6_1",
    "71524_1504_B11_1",
    "67503_1435_F5_1",
    "64490_1227_F11_3",
    "55839_912_D5_1",
    "56615_1501_A2_1",
    "3703_670_G6_2",
    "35707_713_A1_1",
    "14677_172_E11_1",
    "3274_61_E11_1",
    "45683_1440_H11_2",
    "47634_1417_B10_4",
    "44279_527_A2_2",
    "400_56_A10_2",
    "27565_219_G11_1",
    "52643_809_C12_4",
    "3005_92_D2_2",
    "38602_846_F6_2",
    "11388_89_G12_1",
    "5682_79_C10_2",
    "18895_149_G12_2",
    "61173_1757_B4_3",
    "11753_88_C4_1",
    "58315_1219_B12_2",
    "36492_410_B7_2",
    "35648_1787_H3_19",
    "42652_475_C4_1",
    "36738_862_E3_1",
    ]
    class ImJoyPlugin {
      async setup() {
        const images = []
        this.select_callback = async (id)=>{
          api.showStatus('Selected image id: ' + id)
          const tmp = id.split('_')
          await api.showDialog({type: 'imjoy/image', name: id, config: {}, data: {src: "https://images.proteinatlas.org/"+tmp[0]+"/"+tmp[1]+"_"+tmp[2]+"_"+tmp[3]+"_blue_red_green.jpg"}})
        }
        const self = this;
        for(let id of default_image_ids){
            const tmp = id.split('_')
            images.push({
             thumbnail:"https://images.proteinatlas.org/"+tmp[0]+"/"+tmp[1]+"_"+tmp[2]+"_"+tmp[3]+"_blue_red_green_thumb.jpg", 
             original: "https://images.proteinatlas.org/"+tmp[0]+"/"+tmp[1]+"_"+tmp[2]+"_"+tmp[3]+"_blue_red_green.jpg",
             id: tmp[0]+"_"+tmp[1]+"_"+tmp[2]+"_"+tmp[3]
            })
        }
        this.store ={
            methods: {
              select(id){
                if(self.select_callback){
                  self.select_callback(id)
                }
              }
            },
            data() {
                return {
                    images: images
                }
            }
        }
        const App = Vue.extend(this.store)
        this.app = new App().$mount('#app')
        console.log(this.app)
      }
    
      async run(my) {
         if(my.data && my.data.hpa_ids){
            const images = []
            for(let id of  my.data.hpa_ids){
                const tmp = id.split('_')
                images.push({
                thumbnail:"https://images.proteinatlas.org/"+tmp[0]+"/"+tmp[1]+"_"+tmp[2]+"_"+tmp[3]+"_blue_red_green_thumb.jpg", 
                original: "https://images.proteinatlas.org/"+tmp[0]+"/"+tmp[1]+"_"+tmp[2]+"_"+tmp[3]+"_blue_red_green.jpg",
                id: tmp[0]+"_"+tmp[1]+"_"+tmp[2]+"_"+tmp[3]
              })
            }
            this.app.$root.images = images
            this.app.$forceUpdate()
        }
        if(my.data && my.data.select_callback){
          this.select_callback = my.data.select_callback
        }
      }
    }
    api.export(new ImJoyPlugin())
    </script>
    
    <window lang="html">
    <div id="app">
      <div class="thumb">
        <div v-for="image in images" >
          <img :src="image.thumbnail" @click="select(image.id)" class="image" :key="image">
        </div>
      </div>
    </div>
    </window>
    
    <style lang="css">
    .image {
        height: 80px;
        cursor: pointer;
        margin: 5px;
        display: inline-block;
    }
    
    
    .thumb { 
      width: 100%;
      margin: 0 auto;
      border: 1px solid #898989;
      padding: .6vw;
      -ms-flex-wrap: wrap;
      -ms-flex-direction: column;
      -webkit-flex-flow: row wrap; 
      flex-flow: row wrap; 
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
    }
    .thumb div { 
       width: 100px; 
      margin: .6vw; 
      -webkit-box-flex: auto;
      -ms-flex: auto;
      flex: auto; 
    }
    .thumb div img { 
       height: auto; 
      width: 100%; 
    }
    
    @media screen and (max-width: 480px) {
      .thumb div { margin: 0; }
      .thumb { padding: 0; }
      
    }
    </style>